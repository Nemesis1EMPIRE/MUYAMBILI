<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reader — Novels, Manga & Articles</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --muted:#6b7280; --accent:#2563eb; --glass: rgba(255,255,255,0.6);
      --sidebar-w:84px; --radius:14px;
    }
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Arial; margin:0; background:linear-gradient(180deg,#f6f7fb 0%, #eef2ff 100%); color:#0f172a}
    a{color:inherit; text-decoration:none}
    /* Layout */
    .app{display:grid; grid-template-columns: var(--sidebar-w) 1fr; min-height:100vh}
    header{position:sticky; top:0; z-index:30; backdrop-filter: blur(6px); background:transparent}
    /* Sidebar (desktop) */
    .sidebar{width:var(--sidebar-w); background:transparent; display:flex; flex-direction:column; gap:8px; padding:14px}
    .logo{height:48px; display:flex; align-items:center; justify-content:center}
    .nav-btn{display:flex; align-items:center; justify-content:center; width:56px; height:56px; border-radius:12px; background:transparent; color:var(--accent); cursor:pointer}
    .nav-btn.active{background:linear-gradient(180deg, rgba(37,99,235,0.12), rgba(37,99,235,0.06)); box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    /* Main column */
    .main{padding:18px 18px 60px}
    .topbar{display:flex; gap:12px; align-items:center}
    .search{flex:1; display:flex; gap:8px; align-items:center; background:var(--card); padding:8px; border-radius:12px; box-shadow:0 6px 18px rgba(16,24,40,0.04)}
    .search input{border:0; outline:0; font-size:14px; flex:1}
    .filters{display:flex; gap:6px}
    .chip{padding:6px 10px; border-radius:999px; background:#eef2ff; color:var(--accent); font-weight:600; font-size:13px}
    /* Grid */
    .grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:14px; margin-top:18px}
    .card{background:var(--card); border-radius:12px; padding:12px; box-shadow:0 6px 20px rgba(15,23,42,0.04)}
    .cover{height:140px; border-radius:8px; background:linear-gradient(180deg,#ddd,#bbb); display:flex; align-items:end; padding:8px; color:white; font-weight:700}
    .meta{display:flex; justify-content:space-between; align-items:center; margin-top:10px}
    .title{font-weight:700}
    .subtitle{color:var(--muted); font-size:13px}
    /* Carousel */
    .carousel{display:flex; gap:12px; overflow:auto; padding-bottom:6px}
    .carousel .card{min-width:300px}
    /* Description / reading view */
    .panel{background:var(--card); padding:16px; border-radius:12px; margin-top:12px}
    .chapter{padding:14px; border-radius:10px; background:linear-gradient(180deg,#fff,#fbfdff); margin-top:8px}
    .comment{border-top:1px solid #eee; padding:10px 0}
    /* Account */
    .account-list{display:flex; flex-direction:column; gap:10px}
    .history-item{display:flex; gap:10px; align-items:center}
    .favicon{width:44px; height:44px; border-radius:8px; background:#e8eefc; display:flex; align-items:center; justify-content:center; font-weight:700}
    /* Responsive: mobile - move sidebar to bottom */
    @media (max-width:900px){
      .app{grid-template-columns: 1fr}
      .sidebar{position:fixed; bottom:10px; left:50%; transform:translateX(-50%); flex-direction:row; gap:10px; padding:8px; background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.75)); border-radius:999px; box-shadow:0 6px 20px rgba(2,6,23,0.12)}
      .main{padding:12px 12px 120px}
      .logo{display:none}
    }
    /* small niceties */
    .muted{color:var(--muted)}
    .btn{padding:8px 12px; border-radius:10px; background:var(--accent); color:white; border:0; cursor:pointer}
    .btn.ghost{background:transparent; color:var(--accent); border:1px solid rgba(37,99,235,0.12)}
    .views{font-size:13px; color:var(--muted)}
    .comments-list{max-height:240px; overflow:auto}
  </style>
</head>
<body>
  <div class="app">
    <nav class="sidebar" id="sidebar">
      <div class="logo" title="Reader">
        <div style="width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#2563eb,#7c3aed);display:flex;align-items:center;justify-content:center;color:white;font-weight:800">R</div>
      </div>
      <button class="nav-btn active" data-route="home" title="Home"><i class="fa-solid fa-house"></i></button>
      <button class="nav-btn" data-route="books" title="Books"><i class="fa-solid fa-book"></i></button>
      <button class="nav-btn" data-route="manga" title="Manga"><i class="fa-solid fa-book-open"></i></button>
      <button class="nav-btn" data-route="articles" title="Articles"><i class="fa-solid fa-newspaper"></i></button>
      <button class="nav-btn" data-route="account" title="My Account"><i class="fa-solid fa-user"></i></button>
    </nav>

    <main class="main">
      <div class="topbar">
        <div class="search">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input id="searchInput" placeholder="Search by title, author, or genre... (press Enter)" />
          <div class="filters">
            <div class="chip" id="filterAll">All</div>
            <div class="chip" id="filterBooks">Books</div>
            <div class="chip" id="filterManga">Manga</div>
            <div class="chip" id="filterArticles">Articles</div>
          </div>
        </div>
        <div style="margin-left:8px"><button class="btn" id="btnNewItem">Add demo item</button></div>
      </div>

      <div id="content"></div>

    </main>
  </div>

  <script>
    /***** DATA (you may add/edit items below) *****/
    // The only invented data are the items below. Each has id, kind: book|manga|article, title, author, genre, description, chapters.
    const ITEMS = [
      {
        id:'t1', kind:'book', title:'The Last Harbor', author:'A. Mbala', genre:'Adventure', coverColor:'#2563eb', description:'A seafaring adventure across a changing world.',
        chapters:[{id:'t1-c1',title:'Chapter 1 — The Call'},{id:'t1-c2',title:'Chapter 2 — Storms'}]
      },
      {
        id:'t2', kind:'book', title:'Quiet Algorithms', author:'L. Nkomo', genre:'Tech', coverColor:'#7c3aed', description:'Interlinked tales of coders and cities.',
        chapters:[{id:'t2-c1',title:'Preface'},{id:'t2-c2',title:'Recursive Heart'}]
      },
      {
        id:'m1', kind:'manga', title:'Blade of the Mango', author:'S. Yoko', genre:'Action', coverColor:'#db2777', description:'A samurai with a secret past fights for the orchard.',
        chapters:[{id:'m1-c1',title:'Prologue'},{id:'m1-c2',title:'Fight at Dawn'}]
      },
      {
        id:'a1', kind:'article', title:'Modern Storytelling', author:'I. Djouma', genre:'Writing', coverColor:'#059669', description:'How narrative changes with tech.',
        chapters:[{id:'a1-c1',title:'Intro'}]
      }
    ];

    // LocalStorage keys
    const LS = {
      items:'reader_items', // allow adding demo items
      views:'reader_views',
      comments:'reader_comments',
      history:'reader_history'
    };

    // initialize persistent items (so user can add demo items that persist)
    if(!localStorage.getItem(LS.items)) localStorage.setItem(LS.items, JSON.stringify(ITEMS));

    /***** Utilities *****/
    const getAllItems = ()=> JSON.parse(localStorage.getItem(LS.items) || '[]');
    const saveAllItems = (arr)=> localStorage.setItem(LS.items, JSON.stringify(arr));
    const getViews = ()=> JSON.parse(localStorage.getItem(LS.views) || '{}');
    const saveViews = (o)=> localStorage.setItem(LS.views, JSON.stringify(o));
    const getComments = ()=> JSON.parse(localStorage.getItem(LS.comments) || '{}');
    const saveComments = (o)=> localStorage.setItem(LS.comments, JSON.stringify(o));
    const getHistory = ()=> JSON.parse(localStorage.getItem(LS.history) || '[]');
    const saveHistory = (h)=> localStorage.setItem(LS.history, JSON.stringify(h));

    /***** Routing & rendering *****/
    const content = document.getElementById('content');
    const sidebarBtns = document.querySelectorAll('.nav-btn');

    function setActiveRoute(route){
      sidebarBtns.forEach(b=> b.classList.toggle('active', b.dataset.route===route));
    }

    function navigateTo(route, params){
      location.hash = route + (params?('?'+new URLSearchParams(params).toString()):'');
    }

    function readRoute(){
      const hash = location.hash.slice(1) || 'home';
      const [route, qs] = hash.split('?');
      const params = Object.fromEntries(new URLSearchParams(qs || ''));
      return {route, params};
    }

    window.addEventListener('hashchange', renderRoute);
    sidebarBtns.forEach(b=> b.addEventListener('click', ()=>{ navigateTo(b.dataset.route); }));

    // Search handling
    document.getElementById('searchInput').addEventListener('keydown', (e)=>{
      if(e.key==='Enter') doSearch();
    });
    document.getElementById('filterAll').addEventListener('click', ()=>{ document.getElementById('searchInput').value=''; doSearch(); });
    document.getElementById('filterBooks').addEventListener('click', ()=>{ document.getElementById('searchInput').value='kind:book'; doSearch(); });
    document.getElementById('filterManga').addEventListener('click', ()=>{ document.getElementById('searchInput').value='kind:manga'; doSearch(); });
    document.getElementById('filterArticles').addEventListener('click', ()=>{ document.getElementById('searchInput').value='kind:article'; doSearch(); });

    document.getElementById('btnNewItem').addEventListener('click', ()=>{
      // creates a new demo item (invented data allowed) and persists
      const all = getAllItems();
      const id = 'x'+Date.now();
      const newItem = {id, kind:'book', title:'Demo Story '+(all.length+1), author:'You', genre:'Demo', coverColor:'#f97316', description:'A demo story created by the user.', chapters:[{id:id+'-c1',title:'Chapter 1'}]};
      all.push(newItem); saveAllItems(all);
      alert('Demo item added to library. Use search or browse to find it.');
      renderRoute();
    });

    function doSearch(){
      const q = document.getElementById('searchInput').value.trim();
      if(!q){ navigateTo('home'); return; }
      // interpret operators: kind:book, author:name, genre:name
      const filters = {};
      const parts = q.split(/\s+/).map(p=>p.trim()).filter(Boolean);
      const terms = [];
      parts.forEach(p=>{
        const [k,v] = p.split(':');
        if(v && ['kind','author','genre','title'].includes(k)) filters[k]=v.toLowerCase(); else terms.push(p.toLowerCase());
      });
      const list = getAllItems().filter(it=>{
        if(filters.kind && it.kind.toLowerCase()!==filters.kind) return false;
        if(filters.author && !it.author.toLowerCase().includes(filters.author)) return false;
        if(filters.genre && !it.genre.toLowerCase().includes(filters.genre)) return false;
        // terms match title, author, genre
        return terms.every(t=> it.title.toLowerCase().includes(t) || it.author.toLowerCase().includes(t) || it.genre.toLowerCase().includes(t));
      });
      renderSearchResults(q, list);
    }

    function renderSearchResults(q, list){
      setActiveRoute('home');
      content.innerHTML = `<h2>Search results for "${escapeHtml(q)}" — ${list.length} found</h2><div class=grid id="resultsGrid"></div>`;
      const grid = document.getElementById('resultsGrid');
      list.forEach(it=> grid.appendChild(renderCard(it)));
    }

    // Escape helper
    function escapeHtml(s){ return String(s).replace(/[&<>\"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c])); }

    function renderCard(item){
      const el = document.createElement('div'); el.className='card';
      el.innerHTML = `
        <div class=cover style="background:${item.coverColor}"><div style="padding:10px">${escapeHtml(item.title)}</div></div>
        <div class=meta>
          <div>
            <div class=title>${escapeHtml(item.title)}</div>
            <div class=subtitle>${escapeHtml(item.author)} • ${escapeHtml(item.genre)} • ${escapeHtml(item.kind)}</div>
          </div>
          <div style="text-align:right">
            <div class=views id="v-${item.id}">Views: ${getViews()[item.id] || 0}</div>
            <div style="margin-top:10px"><button class="btn" data-open="${item.id}">Open</button></div>
          </div>
        </div>
      `;
      el.querySelector('button[data-open]').addEventListener('click', ()=>{ navigateTo('desc', {id:item.id}); });
      return el;
    }

    function renderHome(){
      const all = getAllItems();
      content.innerHTML = `
        <h1>Welcome to Reader</h1>
        <div class=carousel id="featured"></div>
        <h3 style="margin-top:18px">Library</h3>
        <div class=grid id="libraryGrid"></div>
      `;
      const featured = document.getElementById('featured');
      all.slice(0,6).forEach(it=>{
        const c = renderCard(it); c.style.minWidth='360px'; featured.appendChild(c);
      });
      const lib = document.getElementById('libraryGrid'); all.forEach(it=> lib.appendChild(renderCard(it)));
    }

    function renderList(kind){
      const all = getAllItems().filter(x=>x.kind===kind);
      content.innerHTML = `<h2>${kind[0].toUpperCase()+kind.slice(1)}</h2><div class=grid id="listGrid"></div>`;
      const grid = document.getElementById('listGrid'); all.forEach(it=> grid.appendChild(renderCard(it)));
    }

    function renderDesc(id){
      const it = getAllItems().find(x=>x.id===id);
      if(!it) return content.innerHTML='<p>Item not found.</p>';
      // description page: lists chapters and button to open reading page
      content.innerHTML = `
        <div class=panel>
          <div style="display:flex;gap:12px;align-items:center">
            <div style="width:120px;height:160px;border-radius:10px;background:${it.coverColor};display:flex;align-items:flex-end;padding:8px;color:white;font-weight:700">${escapeHtml(it.title)}</div>
            <div>
              <h2>${escapeHtml(it.title)}</h2>
              <div class=muted>${escapeHtml(it.author)} • ${escapeHtml(it.genre)} • ${escapeHtml(it.kind)}</div>
              <p style="margin-top:8px">${escapeHtml(it.description)}</p>
            </div>
          </div>
          <div style="margin-top:12px">
            <h3>Chapters</h3>
            <div id="chapList"></div>
          </div>
        </div>
      `;
      const chapList = document.getElementById('chapList');
      it.chapters.forEach(ch=>{
        const chEl = document.createElement('div'); chEl.className='chapter';
        chEl.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${escapeHtml(ch.title)}</strong><div class=muted style="font-size:13px">${escapeHtml(it.title)}</div></div><div><button class="btn" data-open="${ch.id}">Read</button></div></div>`;
        chEl.querySelector('button').addEventListener('click', ()=>{ navigateTo('read', {item:it.id, chapter:ch.id}); });
        chapList.appendChild(chEl);
      });
    }

    function renderRead(params){
      const {item, chapter} = params;
      const it = getAllItems().find(x=>x.id===item);
      if(!it) return content.innerHTML='<p>Not found</p>';
      const ch = it.chapters.find(c=>c.id===chapter) || it.chapters[0];
      // update views and history
      const views = getViews(); views[it.id]= (views[it.id]||0) + 1; saveViews(views);
      // history entry
      const history = getHistory(); history.unshift({item:it.id, chapter:ch.id, title:it.title, chapterTitle:ch.title, when: new Date().toISOString()}); saveHistory(history.slice(0,200));
      // render reading page with comments
      content.innerHTML = `
        <div class=panel>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h2>${escapeHtml(it.title)} — <span class=muted>${escapeHtml(ch.title)}</span></h2>
              <div class=muted id="viewsNow">Views: ${views[it.id]}</div>
            </div>
            <div><button class="btn ghost" id="btnBack">Back to description</button></div>
          </div>
          <article style="margin-top:12px; line-height:1.6; color:#111; font-size:16px;">
            <p><em>This is the reading view. Replace with real chapter content from your database. For demo, we generate placeholder paragraphs so the site is functional.</em></p>
            ${generateLorem(5)}
          </article>
          <div style="margin-top:12px">
            <h3>Comments</h3>
            <div id="comments" class="comments-list"></div>
            <div style="margin-top:8px; display:flex; gap:8px; align-items:center">
              <input id="commentInput" placeholder="Write a comment..." style="flex:1; padding:8px; border-radius:10px; border:1px solid #eee" />
              <button class="btn" id="btnComment">Send</button>
            </div>
          </div>
        </div>
      `;

      document.getElementById('btnBack').addEventListener('click', ()=> navigateTo('desc', {id:it.id}));
      document.getElementById('viewsNow').innerText = 'Views: '+getViews()[it.id];

      // load comments
      loadComments(it.id, ch.id);
      document.getElementById('btnComment').addEventListener('click', ()=>{
        const text = document.getElementById('commentInput').value.trim(); if(!text) return;
        const all = getComments(); const key = it.id + '::' + ch.id; all[key] = all[key] || [];
        all[key].push({text, when:new Date().toISOString()}); saveComments(all); document.getElementById('commentInput').value=''; loadComments(it.id,ch.id);
      });

      // update any visible view counters on cards
      const vf = document.getElementById('v-'+it.id); if(vf) vf.innerText = 'Views: '+getViews()[it.id];
    }

    function loadComments(itemId, chapterId){
      const all = getComments(); const key = itemId+'::'+chapterId; const list = all[key] || [];
      const container = document.getElementById('comments'); container.innerHTML='';
      if(list.length===0) container.innerHTML='<div class=muted>No comments yet. Be the first.</div>';
      list.forEach(c=>{
        const div = document.createElement('div'); div.className='comment'; div.innerHTML=`<div style="font-size:13px; color:#0f172a">${escapeHtml(c.text)}</div><div class=muted style="font-size:12px">${new Date(c.when).toLocaleString()}</div>`;
        container.appendChild(div);
      });
    }

    function renderAccount(){
      const history = getHistory();
      content.innerHTML = `
        <h2>My Account</h2>
        <div class=panel>
          <h3>Reading history</h3>
          <div class=account-list id="historyList"></div>
          <div style="margin-top:12px"><button class="btn" id="clearHistory">Clear history</button></div>
        </div>
      `;
      const list = document.getElementById('historyList');
      if(history.length===0) list.innerHTML='<div class=muted>No reading history yet. Read chapters to populate this list.</div>';
      history.forEach(h=>{
        const item = getAllItems().find(x=>x.id===h.item) || {}; const div = document.createElement('div'); div.className='history-item';
        div.innerHTML = `<div class=favicon style="background:${item.coverColor||'#e6f1ff'}">${(item.title||'•').slice(0,2).toUpperCase()}</div><div style="flex:1"><div style="font-weight:700">${escapeHtml(h.title)}</div><div class=muted style="font-size:13px">${escapeHtml(h.chapterTitle)} • ${new Date(h.when).toLocaleString()}</div></div><div><button class=btn data-open="${h.item}::${h.chapter}">Open</button></div>`;
        div.querySelector('button').addEventListener('click', ()=>{
          const [it,ch]=h.item+'::'+h.chapter.split('::'); // fallback
          navigateTo('read',{item:h.item, chapter:h.chapter});
        });
        list.appendChild(div);
      });
      document.getElementById('clearHistory').addEventListener('click', ()=>{ if(confirm('Clear reading history?')){ saveHistory([]); renderAccount(); } });
    }

    // helper to generate lorem paragraphs
    function generateLorem(n){ let s=''; for(let i=0;i<n;i++) s+='<p>'+['The sea moved like a thought.','They walked until the lamps blurred.','Code and story braided through his memory.','The orchard smelled of rain and iron.','She remembered the old song.'][i%5]+'</p>'; return s; }

    // Main renderer
    function renderRoute(){
      const {route, params} = readRoute();
      setActiveRoute(route);
      if(route==='home') renderHome();
      else if(route==='books') renderList('book');
      else if(route==='manga') renderList('manga');
      else if(route==='articles') renderList('article');
      else if(route==='desc' && params.id) renderDesc(params.id);
      else if(route==='read' && params.item && params.chapter){
        // IMPORTANT: Before accessing the reading page, ensure it redirects from description — we assume the app's UI does that by requiring users to click "Read" on the description page.
        // However if a user navigates directly, we still allow reading but simulate the same flow (views/history increment).
        renderRead(params);
      }
      else if(route==='account') renderAccount();
      else renderHome();
    }

    // initialize
    renderRoute();

    // small UX: clicking left nav updates active style
    // keep sidebar nav in sync with hash

    // Allow users to comment with Enter key
    document.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && document.activeElement && document.activeElement.id==='commentInput'){
        const btn = document.getElementById('btnComment'); if(btn) btn.click();
      }
    });

    // Ensure search returns results by title/author/genre
    // We already implemented doSearch which looks at title/author/genre. Example queries: "Quiet" or "author:L. Nkomo" or "kind:manga"

    // Expose simple API on window for debugging
    window.READER = {getAllItems, getViews, getComments, getHistory, navigateTo};

  </script>
</body>
</html>
