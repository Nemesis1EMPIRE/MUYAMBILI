<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Lecture en Ligne</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ---- STYLE GLOBAL ---- */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
}

header {
    background: #111;
    padding: 20px;
    color: white;
}

/* ---- NOM DU SITE ---- */
#site-name {
    font-size: 28px;
    font-weight: bold;
    text-align: center;
}

/* ---- CAROUSEL ---- */
.carousel {
    width: 100%;
    height: 180px;
    overflow: hidden;
    position: relative;
    margin: 15px 0;
}

.carousel img {
    width: 100%;
    height: 180px;
    object-fit: cover;
}

/* ---- BARRE DE RECHERCHE ---- */
.search-container {
    display: flex;
    justify-content: center;
    margin: 15px;
}

.search-container input {
    width: 70%;
    padding: 10px;
    border-radius: 6px;
    border: none;
}

/* ---- SIDEBAR DESKTOP ---- */
.sidebar {
    width: 70px;
    background: #222;
    color: white;
    position: fixed;
    top: 0;
    bottom: 0;
    padding-top: 120px;
    text-align: center;
}

.sidebar div {
    margin-bottom: 40px;
    cursor: pointer;
}

/* ---- VERSION MOBILE ---- */
@media(max-width: 700px) {
    .sidebar {
        top: auto;
        bottom: 0;
        width: 100%;
        height: 60px;
        padding-top: 0;
        display: flex;
        justify-content: space-around;
        align-items: center;
    }
}

/* ---- LISTE DES LIVRES ---- */
#content {
    margin-left: 90px;
    padding: 15px;
}

.book-card {
    background: white;
    padding: 12px;
    width: 160px;
    border-radius: 8px;
    display: inline-block;
    margin: 10px;
    cursor: pointer;
}

.book-card img {
    width: 100%;
    height: 210px;
    object-fit: cover;
    border-radius: 6px;
}

/* ---- PAGE DESCRIPTION ---- */
#description-page {
    display: none;
    padding: 15px;
}

.chapter-btn {
    background: black;
    color: white;
    padding: 10px;
    border: none;
    border-radius: 8px;
    margin-top: 10px;
    cursor: pointer;
}

/* ---- PAGE LECTURE (PDF) ---- */
#reader-page {
    display: none;
    padding: 15px;
}

iframe {
    width: 100%;
    height: 500px;
    border: none;
    margin-top: 15px;
}

/* ---- COMMENTAIRES ---- */
#comments {
    margin-top: 20px;
}

#comments textarea {
    width: 100%;
    height: 90px;
}

</style>
</head>
<body>

<header>
    <div id="site-name">Lectura</div>

    <div class="carousel">
        <img id="carousel-img" src="">
    </div>

    <div class="search-container">
        <input type="text" id="search" placeholder="Rechercher par titre, auteur, genre...">
    </div>
</header>

<!-- SIDEBAR -->
<div class="sidebar">
    <div onclick="showCategory('books')">ðŸ“š</div>
    <div onclick="showCategory('manga')">ðŸ§§</div>
    <div onclick="showCategory('articles')">ðŸ“°</div>
    <div onclick="showAccount()">ðŸ‘¤</div>
</div>

<div id="content"></div>

<div id="description-page"></div>
<div id="reader-page"></div>

<script>
/* ======== BASE DE DONNÃ‰ES ======== */
const items = [
{
    id: 1,
    type: "book",
    title: "La Nuit Rouge",
    author: "A. Mavungu",
    genre: "Fantaisie",
    cover: "covers/book1.jpg",
    description: "Un roman de fantasy captivant.",
    chapters: [
        { title: "Chapitre 1", pdf: "chapters/book1_ch1.pdf", views: 0 }
    ]
},
{
    id: 2,
    type: "manga",
    title: "Samurai Spirit",
    author: "Kenjiro",
    genre: "Action",
    cover: "covers/manga1.jpg",
    description: "Un jeune samouraÃ¯ au destin incroyable.",
    chapters: [
        { title: "Chapitre 1", pdf: "chapters/manga1_ch1.pdf", views: 0 }
    ]
}
];

/* ======== CAROUSEL ======== */
let index = 0;
setInterval(() => {
    document.getElementById("carousel-img").src = items[index].cover;
    index = (index + 1) % items.length;
}, 2000);

/* ======== AFFICHAGE DES LIVRES ======== */
function showCategory(type) {
    document.getElementById("description-page").style.display = "none";
    document.getElementById("reader-page").style.display = "none";

    let html = "<h2>" + type.toUpperCase() + "</h2>";

    items.filter(x => x.type === type).forEach(book => {
        html += `
        <div class="book-card" onclick="showDescription(${book.id})">
            <img src="${book.cover}">
            <h4>${book.title}</h4>
            <small>${book.author}</small>
        </div>
        `;
    });

    document.getElementById("content").innerHTML = html;
}
showCategory("books");

/* ======== PAGE DESCRIPTION ======== */
function showDescription(id) {
    let book = items.find(x => x.id === id);
    document.getElementById("content").innerHTML = "";
    document.getElementById("description-page").style.display = "block";

    let chaptersHTML = "";

    book.chapters.forEach((ch, i) => {
        chaptersHTML += `
            <button class="chapter-btn" onclick="readChapter(${id}, ${i})">
                ${ch.title} (vues : ${ch.views})
            </button><br>
        `;
    });

    document.getElementById("description-page").innerHTML = `
        <h2>${book.title}</h2>
        <img src="${book.cover}" style="width:200px;">
        <p>Auteur : ${book.author}</p>
        <p>Genre : ${book.genre}</p>
        <p>${book.description}</p>

        <h3>Chapitres</h3>
        ${chaptersHTML}
    `;
}

/* ======== PAGE DE LECTURE (PDF) ======== */
function readChapter(id, index) {
    let book = items.find(x => x.id === id);

    // compteur de vues
    book.chapters[index].views++;

    // sauvegarde historique
    saveHistory(book.title + " - " + book.chapters[index].title);

    document.getElementById("description-page").style.display = "none";
    document.getElementById("reader-page").style.display = "block";

    document.getElementById("reader-page").innerHTML = `
        <h2>${book.title} - ${book.chapters[index].title}</h2>

        <iframe src="${book.chapters[index].pdf}"></iframe>

        <h3>Commentaires</h3>
        <div id="comments">
            <textarea id="commentText"></textarea>
            <button onclick="addComment(${id},${index})">Publier</button>
            <div id="commentList"></div>
        </div>
    `;

    loadComments(id, index);
}

/* ======== COMMENTAIRES ======== */
function addComment(id, index) {
    let key = "comments_" + id + "_" + index;
    let list = JSON.parse(localStorage.getItem(key) || "[]");

    list.push(document.getElementById("commentText").value);

    localStorage.setItem(key, JSON.stringify(list));
    loadComments(id, index);
}

function loadComments(id, index) {
    let key = "comments_" + id + "_" + index;
    let list = JSON.parse(localStorage.getItem(key) || "[]");

    let html = "";
    list.forEach(c => html += "<p>â€¢ " + c + "</p>");

    document.getElementById("commentList").innerHTML = html;
}

/* ======== HISTORIQUE ======== */
function saveHistory(entry) {
    let list = JSON.parse(localStorage.getItem("history") || "[]");
    list.push(entry);
    localStorage.setItem("history", JSON.stringify(list));
}

function showAccount() {
    let list = JSON.parse(localStorage.getItem("history") || "[]");

    let html = "<h2>Mon Compte</h2><h3>Historique de Lecture</h3>";
    list.forEach(h => html += "<p>ðŸ“– " + h + "</p>");

    document.getElementById("content").innerHTML = html;
}

/* ======== RECHERCHE ======== */
document.getElementById("search").addEventListener("input", function() {
    let q = this.value.toLowerCase();

    let results = items.filter(b =>
        b.title.toLowerCase().includes(q) ||
        b.author.toLowerCase().includes(q) ||
        b.genre.toLowerCase().includes(q)
    );

    let html = "<h2>RÃ©sultats</h2>";

    results.forEach(book => {
        html += `
        <div class="book-card" onclick="showDescription(${book.id})">
            <img src="${book.cover}">
            <h4>${book.title}</h4>
            <small>${book.author}</small>
        </div>
        `;
    });

    document.getElementById("content").innerHTML = html;
});
</script>

</body>
</html>
